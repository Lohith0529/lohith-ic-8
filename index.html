<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ICE-8 — Map • Tree • Network (All-in-One)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#f7f7fb;--fg:#111;--card:#fff;--border:#e7e7ef}
  html,body{background:var(--bg);color:var(--fg);margin:0;font-family:system-ui,Segoe UI,Arial,sans-serif}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);z-index:10;padding:10px 16px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  header .brand{font-weight:700;padding:8px 0}
  header a{padding:8px 12px;border:1px solid var(--border);border-radius:10px;text-decoration:none;color:inherit}
  section{padding:22px 16px;max-width:1200px;margin:0 auto}
  h2{margin:6px 0 12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px 12px 16px;box-shadow:0 1px 2px rgba(0,0,0,.03);margin:10px 0}
  .row{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
  svg{background:#fff;display:block;border:1px solid var(--border);border-radius:10px}
  .legend text{font-size:12px}
</style>
</head>
<body>
<header>
  <div class="brand">ICE-8 All‑in‑One</div>
  <a href="#map">Map</a>
  <a href="#tree">Family Tree</a>
  <a href="#network">Network</a>
</header>

<section id="map">
  <h2>Part 1 — Map (World • Natural Earth)</h2>
  <div class="card">
    <svg id="map_svg" width="980" height="540" aria-label="World map visualization"></svg>
  </div>
</section>

<section id="tree">
  <h2>Part 2 — Family Tree (3+ layers)</h2>
  <div class="card">
    <svg id="tree_svg" width="920" height="520" aria-label="Family tree visualization"></svg>
  </div>
</section>

<section id="network">
  <h2>Part 3 — Conceptual Network (≥6 nodes)</h2>
  <div class="card">
    <svg id="net_svg" width="920" height="520" aria-label="Network visualization"></svg>
  </div>
</section>

<!-- UMD builds: work from file:// or http:// -->
<script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>
<script>
// ================= MAP =================
(function(){
  const svg = d3.select("#map_svg");
  const w = +svg.attr("width"), h = +svg.attr("height");

  fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
    .then(r => r.json())
    .then(world => {
      const countries = topojson.feature(world, world.objects.countries).features;
      const projection = d3.geoNaturalEarth1().fitSize([w, h], {type:"Sphere"});
      const path = d3.geoPath(projection);

      svg.append("path").attr("d", path({type:"Sphere"})).attr("fill", "#eef6ff");
      const grat = d3.geoGraticule10();
      svg.append("path").attr("d", path(grat)).attr("stroke", "#d9e3f0").attr("fill","none");

      // Metric: Internet Users % (sample values; clearly different from tutorial)
      const valueByISO = { USA:89, CAN:91, MEX:74, BRA:81, ARG:86, CHN:73, IND:56, RUS:88, AUS:93, ZAF:70, FRA:92, DEU:93, JPN:94, GBR:95, ITA:90, ESP:92, NGA:55, EGY:60 };
      const values = Object.values(valueByISO);
      const color = values.length ? d3.scaleQuantize().domain([d3.min(values), d3.max(values)]).range(d3.schemeBlues[7]) : () => "#ccc";

      svg.append("g")
        .selectAll("path")
        .data(countries)
        .join("path")
          .attr("d", path)
          .attr("fill", d => {
            const v = valueByISO[d.id];
            return v == null ? "#eee" : color(v);
          })
          .attr("stroke","#505a6b").attr("stroke-width",0.35)
        .append("title")
          .text(d => `${d.properties.name}: ${valueByISO[d.id] != null ? valueByISO[d.id] + "% internet users" : "No data"}`);

      // Legend
      if(values.length){
        const g = svg.append("g").attr("class","legend").attr("transform","translate(20,22)");
        g.append("text").text("Internet Users (%)").attr("font-weight","600").attr("y",-6);
        const thresholds = color.thresholds ? color.thresholds() : color.range().map((_,i)=>i);
        const scale = [d3.min(values)].concat(thresholds).concat([d3.max(values)]);
        scale.slice(0,-1).forEach((s,i)=>{
          g.append("rect").attr("x",0).attr("y", i*16).attr("width",16).attr("height",12).attr("fill", color((s+scale[i+1])/2));
          g.append("text").attr("x",22).attr("y", i*16+10).text(`${Math.round(s)}–${Math.round(scale[i+1])}`);
        });
      }
    });
})();

// ================= TREE =================
(function(){
  const svg = d3.select("#tree_svg"), w = +svg.attr("width"), h = +svg.attr("height");
  const data = [
    {id:"Grandparent"},
    {id:"Parent A", parentId:"Grandparent"},
    {id:"Parent B", parentId:"Grandparent"},
    {id:"Child A1", parentId:"Parent A"},
    {id:"Child A2", parentId:"Parent A"},
    {id:"Child B1", parentId:"Parent B"},
    {id:"Grandchild A1a", parentId:"Child A1"}
  ];
  const root = d3.stratify().id(d=>d.id).parentId(d=>d.parentId)(data);
  const layout = d3.tree().size([w-60, h-80]);
  const treeroot = layout(root);
  const g = svg.append("g").attr("transform","translate(30,40)");
  g.append("g").selectAll("path")
    .data(treeroot.links())
    .join("path").attr("fill","none").attr("stroke","#9aa4b2")
    .attr("d", d3.linkHorizontal().x(d=>d.x).y(d=>d.y));
  const node = g.append("g").selectAll("g")
    .data(treeroot.descendants()).join("g")
    .attr("transform", d => `translate(${d.x},${d.y})`);
  node.append("circle").attr("r",6)
      .attr("fill", d => d.depth===0 ? "#3949ab" : d.depth===1 ? "#1e88e5" : d.depth===2 ? "#26a69a" : "#66bb6a");
  node.append("text").attr("dy",-10).attr("text-anchor","middle").text(d=>d.id);
})();

// ================= NETWORK =================
(function(){
  const svg = d3.select("#net_svg"), w = +svg.attr("width"), h = +svg.attr("height");
  const nodes = [{id:"Alpha"},{id:"Bravo"},{id:"Charlie"},{id:"Delta"},{id:"Echo"},{id:"Foxtrot"},{id:"Golf"}];
  const links = [
    {source:"Alpha",target:"Bravo"},
    {source:"Alpha",target:"Charlie"},
    {source:"Bravo",target:"Delta"},
    {source:"Charlie",target:"Echo"},
    {source:"Delta",target:"Foxtrot"},
    {source:"Echo",target:"Foxtrot"},
    {source:"Foxtrot",target:"Golf"}
  ];

  const sim = d3.forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d=>d.id).distance(90))
    .force("charge", d3.forceManyBody().strength(-160))
    .force("center", d3.forceCenter(w/2, h/2));

  const link = svg.append("g").selectAll("line")
    .data(links).join("line").attr("stroke","#b0b8c4").attr("stroke-width",1.6);

  const node = svg.append("g").selectAll("circle")
    .data(nodes).join("circle").attr("r",7).attr("fill","#26a69a")
    .call(d3.drag()
      .on("start", (event,d)=>{ if(!event.active) sim.alphaTarget(0.3).restart(); d.fx=d.x; d.fy=d.y; })
      .on("drag", (event,d)=>{ d.fx=event.x; d.fy=event.y; })
      .on("end",  (event,d)=>{ if(!event.active) sim.alphaTarget(0); d.fx=null; d.fy=null; }));

  const label = svg.append("g").selectAll("text")
    .data(nodes).join("text").text(d=>d.id).attr("font-size",12).attr("fill","#263238");

  sim.on("tick", () => {
    link.attr("x1", d=>d.source.x).attr("y1", d=>d.source.y)
        .attr("x2", d=>d.target.x).attr("y2", d=>d.target.y);
    node.attr("cx", d=>d.x).attr("cy", d=>d.y);
    label.attr("x", d=>d.x+8).attr("y", d=>d.y+4);
  });
})();
</script>
</body>
</html>
